
@{
    ViewData["Title"] = "Home Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css">
<style>
    body {
        font-family: "Lato", sans-serif;
    }

    .sidenav {
        height: 100%;
        width: 0;
        position: fixed;
        z-index: 1;
        top: 0;
        left: 0;
        background-color: #111;
        overflow-x: hidden;
        transition: 0.5s;
        padding-top: 60px;
    }

        .sidenav a {
            padding: 8px 8px 8px 32px;
            text-decoration: none;
            font-size: 25px;
            color: #818181;
            display: block;
            transition: 0.3s;
        }

            .sidenav a:hover {
                color: #f1f1f1;
            }

        .sidenav .closebtn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }


    body {
        font-family: helvetica, arial;
        font-size: 12px
    }

    .scrumboard {
        margin: 15px auto;
        width: 100%;
        border: solid 1px black;
    }

    .column {
        width: 50%;
        float: left;
        border: solid 2px black;
        height: 100vh;
    }

    .portlet {
        margin: 0 1em 1em 1em;
        padding: 0.3em;
    }

    .portlet-header {
        padding: 0.2em 0.3em;
        margin-bottom: 0.5em;
        position: relative;
    }

    .portlet-toggle {
        position: absolute;
        top: 50%;
        right: 0;
        margin-top: -8px;
    }

    .portlet-content {
        padding: 0.4em;
    }

    .portlet-placeholder {
        border: 1px dotted black;
        margin: 0 1em 1em 0;
        height: 50px;
    }

    a:active {
        color: lime;
    }
</style>



@* <script src="~/lib/jquery/dist/jquery.min.js"></script>*@



<div class="container">
    <main role="main" class="pb-3">

        <div id="mySidenav" class="sidenav" style="width: 250px; margin-top:57px;">
            @*<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>*@
            <a href="#">About</a>
            <a href="#">Services</a>
            <a href="#">Clients</a>
            <a href="#">Contact</a>
        </div>


        @*<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
                    <a class="navbar-brand" href="#">Hidden brand</a>
                    <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                        <li class="nav-item active">
                            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Link</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link disabled" href="#">Disabled</a>
                        </li>
                    </ul>
                    <form class="form-inline my-2 my-lg-0">
                        <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                    </form>
                </div>
            </nav>*@

        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">

            <div class="col-10">

            </div>
            <div class="col-2 pull-right">
                <button class="btn btn-primary" data-toggle="modal" onclick="createModal()">Create</button>

            </div>
        </nav>

        <div class="scrumboard row">


            <div class="column flex">
                <!-- todo -->
                <h1 style="text-align:center;">Open</h1>
                <hr />
                <div class="portlet">
                    <div class="portlet-header">Task</div>
                    <div class="portlet-content">Lorem ipsum dolor sit amet, consectetuer adipiscing elit</div>
                </div>

                <div class="portlet">
                    <div class="portlet-header">Task</div>
                    <div class="portlet-content">Lorem ipsum dolor sit amet, consectetuer adipiscing elit</div>
                </div>

            </div>

            <div class="column flex">
                <!-- ongoing -->
                <h1 style="text-align:center;">Closed</h1>
                <hr />
                <div class="portlet">
                    <div class="portlet-header">Task</div>
                    <div class="portlet-content">Lorem ipsum dolor sit amet, consectetuer adipiscing elit</div>
                </div>

            </div>





            <!--<div class="column flex">-->
            <!-- done -->
            <!--<h1>Testing</h1>

                <div class="portlet">
                    <div class="portlet-header">Task</div>
                    <div class="portlet-content">Lorem ipsum dolor sit amet, consectetuer adipiscing elit</div>
                </div>

                <div class="portlet">
                    <div class="portlet-header">Task</div>
                    <div class="portlet-content">Lorem ipsum dolor sit amet, consectetuer adipiscing elit</div>
                </div>

            </div>

            <div class="column flex">-->
            <!-- done -->
            <!--<h1>Done</h1>

                <div class="portlet">
                    <div class="portlet-header">Task</div>
                    <div class="portlet-content">Lorem ipsum dolor sit amet, consectetuer adipiscing elit</div>
                </div>

                <div class="portlet">
                    <div class="portlet-header">Task</div>
                    <div class="portlet-content">Lorem ipsum dolor sit amet, consectetuer adipiscing elit</div>
                </div>

            </div>-->



        </div>




    </main>
</div>


<div class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">New message</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Title</label>
                        <input type="text" class="form-control" id="title">
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Content</label>
                        <textarea class="form-control" id="content"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">WorkItemType</label>
                        <select class="form-control form-select" aria-label="Default select example" id="workItemType">
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Iteration</label>
                        <select class="form-control form-select" aria-label="Default select example" id="iteration">
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">AssignedTo</label>
                        <select class="form-control form-select" aria-label="Default select example" id="assignedTo">
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">WorkItemState</label>
                        <select class="form-control form-select" aria-label="Default select example" id="workItemState">
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="createWorkItem()">Create</button>
            </div>
        </div>
    </div>
</div>







@*<h2>Animated Sidenav Example</h2>
    <p>Click on the element below to open the side navigation menu.</p>*@
@*<span style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776; open</span>*@

<script>
    $(document).ready(function () {

        funcAjaxRequest("", "/Iterations/GetAllIteration", function (f) {
            var html = "";
            for (var i = 0; i < f.length; i++) {
                html += '<a onclick="getWorkItemsByIteration(this)" href="javascript:void(0)" id=' + f[i].id + '>' + f[i].name + '</a>';
            }
            $("#mySidenav").html(html);
        }, "POST");
    });


    $(function () {
        $(".column").sortable({
            connectWith: ".column",
            handle: ".portlet-header",
            cancel: ".portlet-toggle",
            placeholder: "portlet-placeholder ui-corner-all"
        });

        $(".portlet")
            .addClass("ui-widget ui-widget-content ui-helper-clearfix ui-corner-all")
            .find(".portlet-header")
            .addClass("ui-widget-header ui-corner-all")


        $(".portlet-toggle").click(function () {
            var icon = $(this);
            icon.toggleClass("ui-icon-minusthick ui-icon-plusthick");
            icon.closest(".portlet").find(".portlet-content").toggle();
        });
    });

    //function openNav() {
    //    document.getElementById("mySidenav").style.width = "250px";
    //}

    //function closeNav() {
    //    document.getElementById("mySidenav").style.width = "0";
    //}

    function funcAjaxRequest(model, url, func, type) {
        if (type == null) type = "POST";
        $.ajax({
            type: type,
            async: false, // js ajax Generic islemler icin
            url: url,
            data: JSON.stringify(model),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: func,
            error: function (xhr, errorType, exception) {
                if (xhr.responseText != undefined) {
                    var rText = $('<div/>').html(xhr.responseText.split("</title>")[0]).text();
                    var rTextSplit = rText.split("##");
                    if (xhr.statusText == "warning" || xhr.statusText == "info" || xhr.statusText == "success" || xhr.statusText == "error")
                        toastr.error(rTextSplit[0], rTextSplit[1], true);
                    else {
                        toastr.error(rText, "Hata Mesajı", true);
                        if (rText.indexOf("Login Giriş Ekranı") != -1)
                            window.location = "/Login/Index";
                    }
                }
                else {
                    toastr.error(exception, "Hata Mesajı", true);
                }

            }
        });
    }


    function getWorkItemsByIteration(e) {
        var iterationId = parseInt(e.id);
        funcAjaxRequest("", "/WorkItems/GetWorkItemsByIteration?iterationId=" + iterationId + "", function (f) {
            var html = "";
            for (var i = 0; i < f.length; i++) {
                html += '<a onclick="getWorkItems()" href="javascript:void(0)">' + f[i].name + '</a>';
            }
            $("#iteration").html(html);
        }, "GET");
    }


    function createModal() {
        $('#createModal').modal('show');
         
        funcAjaxRequest("", "/Iterations/GetAllIteration", function (f) {
            var htmlIteration = "";
            for (var i = 0; i < f.length; i++) {
                htmlIteration += '<option value=' + f[i].id + '>' + f[i].name + '</option>';
            }
            $("#iteration").append(htmlIteration);
        }, "POST");

        funcAjaxRequest("", "/WorkItemStates/GetAllWorkItemState", function (f) {
            var htmlWorkItemStates = "";
            for (var i = 0; i < f.length; i++) {
                htmlWorkItemStates += '<option value=' + f[i].id + '>' + f[i].name + '</option>';
            }
            $("#workItemState").append(htmlWorkItemStates);
        }, "POST");

        funcAjaxRequest("", "/WorkItemTypes/GetAllWorkItemType", function (f) {
            var htmlWorkItemTypes = "";
            for (var i = 0; i < f.length; i++) {
                htmlWorkItemTypes += '<option value=' + f[i].id + '>' + f[i].name + '</option>';
            }
            $("#workItemType").append(htmlWorkItemTypes);
        }, "POST");

        funcAjaxRequest("", "/Users/GetAllUser", function (f) {
            var htmlAssignedTo = "";
            for (var i = 0; i < f.length; i++) {
                htmlAssignedTo += '<option value=' + f[i].id + '>' + f[i].name + '</option>';
            }
            $("#assignedTo").append(htmlAssignedTo);
        }, "POST");
    }
    function createWorkItem() {
        $('#createModal').modal('show');
    }
</script>

